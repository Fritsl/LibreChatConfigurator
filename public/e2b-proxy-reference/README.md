# LibreChat E2B Code Interpreter Proxy

This proxy service enables ChatGPT-style code execution in LibreChat using E2B sandboxes. It properly formats responses so that images are rendered correctly in the LibreChat interface.

## ‚ú® Features

- **Proper Image Rendering**: Returns images in LibreChat's expected `content` array format with `image_url` objects
- **Multi-Format Support**: Handles PNG, JPEG, and SVG images from matplotlib and other plotting libraries
- **Structured Output**: Combines text output, console logs, and images in a single response
- **Error Handling**: Gracefully handles execution errors with formatted error messages
- **Docker Ready**: Includes Dockerfile for easy deployment

## üöÄ Quick Start

### Option 1: Docker Compose (Recommended)

Add this service to your LibreChat `docker-compose.yml`:

```yaml
services:
  # ... your existing LibreChat service ...
  
  e2b-proxy:
    build: ./e2b-proxy
    container_name: e2b-proxy
    environment:
      - E2B_API_KEY=${E2B_API_KEY}
    networks:
      - librechat-network
    restart: unless-stopped
```

Then:

1. Copy these files to `./e2b-proxy/` directory
2. Add `E2B_API_KEY=your_api_key_here` to your `.env` file
3. Run `docker-compose up -d`

### Option 2: Standalone Deployment

```bash
npm install
export E2B_API_KEY=your_api_key_here
npm start
```

## üìã Configuration in LibreChat

1. In LibreChat, select **Agents** from the endpoint menu
2. Open the **Agent Builder** panel
3. Click **Create New Agent** or select an existing agent
4. In **Actions** section, click **+ Add Action**
5. Paste the complete OpenAPI schema (from the configurator)
6. Save and start chatting!

## üß™ Testing

Test the health endpoint:
```bash
curl http://localhost:3001/health
```

Test code execution:
```bash
curl -X POST http://localhost:3001/execute \
  -H "Content-Type: application/json" \
  -d '{
    "code": "import matplotlib.pyplot as plt\nimport numpy as np\nx = np.linspace(0, 10, 100)\ny = np.sin(x)\nplt.plot(x, y)\nplt.title(\"Sine Wave\")\nplt.show()"
  }'
```

## üìä Response Format

The proxy returns responses in LibreChat's tool format (same as DALL-E):

```json
[
  [
    {
      "type": "text",
      "text": "**Console Output:**\n```\nHello, World!\n```\n\n**Executed Code:**\n```python\nprint('Hello, World!')\n```"
    }
  ],
  {
    "content": [
      {
        "type": "image_url",
        "image_url": {
          "url": "data:image/png;base64,iVBORw0KGgo..."
        }
      }
    ]
  }
]
```

**This is a TWO-ELEMENT ARRAY:**
1. **First element**: Array of text response objects
2. **Second element**: Object with `content` property containing image objects

This exact format ensures:
- ‚úÖ Images render inline in LibreChat (not as base64 text!)
- ‚úÖ Code blocks are syntax-highlighted
- ‚úÖ Console output is clearly formatted
- ‚úÖ Multiple images are supported
- ‚úÖ Works exactly like DALL-E and other built-in LibreChat tools

## üîß Environment Variables

- `E2B_API_KEY` (required): Your E2B API key from e2b.dev
- `PORT` (optional): Server port, defaults to 3001

## üìù Notes

- The proxy uses E2B SDK v2.0 with the new code interpreter API
- Images are returned as base64 data URIs for immediate display
- Sandboxes are automatically cleaned up after each execution
- Supports Python code execution only (E2B limitation)

## üêõ Troubleshooting

**Images showing as text instead of rendering?**
- Make sure you're using the updated OpenAPI schema from the configurator
- Verify the response format matches the structure above
- Check that you're using the OpenAI provider (not Azure) in LibreChat

**Connection errors?**
- Ensure the e2b-proxy service is on the same Docker network as LibreChat
- Verify the service name in the OpenAPI schema matches your docker-compose service name
- Check health endpoint: `http://e2b-proxy:3001/health`

## üìö Related Links

- [E2B Documentation](https://e2b.dev/docs)
- [LibreChat Documentation](https://www.librechat.ai/docs)
- [LibreChat Configurator](https://librechatconfigurator.netlify.app)

## üìÑ License

MIT - Feel free to use and modify for your needs!

---

Generated by LibreChat Configurator - https://librechatconfigurator.netlify.app
